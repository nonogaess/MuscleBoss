<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Diagnostic Muscle Boss</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        .info { margin: 10px 0; padding: 10px; background: #16213e; border-radius: 8px; }
        .warning { background: #443311; border-left: 4px solid #ff9800; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Diagnostic Muscle Boss</h1>
    
    <div class="info">
        <strong>Date du jour :</strong> <span id="todayDate"></span>
    </div>
    
    <div class="info">
        <strong>Date sauvegard√©e dans localStorage :</strong> <span id="savedDate"></span>
    </div>
    
    <div class="info">
        <strong>Nombre de logs :</strong> <span id="logsCount"></span>
    </div>
    
    <div class="info">
        <strong>Service Worker actif :</strong> <span id="swStatus"></span>
    </div>
    
    <div class="info">
        <strong>Taille localStorage :</strong> <span id="storageSize"></span>
    </div>
    
    <h2>Actions de r√©paration</h2>
    <button onclick="fixDate()">üîß Forcer la date du jour</button>
    <button onclick="clearCache()">üóëÔ∏è Vider le cache</button>
    <button onclick="unregisterSW()">‚ùå D√©sinstaller Service Worker</button>
    <button onclick="fullReset()">‚ö†Ô∏è Reset complet (prudence!)</button>
    
    <div id="result" style="margin-top: 20px;"></div>
    
    <script>
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('todayDate').textContent = today;
        
        // V√©rifier localStorage
        const saved = localStorage.getItem('muscleAppState');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                document.getElementById('savedDate').textContent = data.date || 'N/A';
                document.getElementById('logsCount').textContent = (data.logs || []).length;
            } catch(e) {
                document.getElementById('savedDate').textContent = 'ERREUR: ' + e.message;
            }
        } else {
            document.getElementById('savedDate').textContent = 'Aucune donn√©e';
        }
        
        // V√©rifier Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                document.getElementById('swStatus').textContent = regs.length > 0 ? '‚úÖ Actif (' + regs.length + ')' : '‚ùå Inactif';
            });
        } else {
            document.getElementById('swStatus').textContent = '‚ùå Non support√©';
        }
        
        // Taille storage
        let size = 0;
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                size += localStorage[key].length;
            }
        }
        document.getElementById('storageSize').textContent = (size / 1024).toFixed(2) + ' KB';
        
        function showResult(msg, isError = false) {
            const div = document.getElementById('result');
            div.innerHTML = `<div class="info ${isError ? 'warning' : ''}">${msg}</div>`;
        }
        
        function fixDate() {
            const saved = localStorage.getItem('muscleAppState');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    data.date = today;
                    localStorage.setItem('muscleAppState', JSON.stringify(data));
                    showResult('‚úÖ Date mise √† jour vers ' + today);
                    setTimeout(() => location.reload(), 1000);
                } catch(e) {
                    showResult('‚ùå Erreur: ' + e.message, true);
                }
            }
        }
        
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(keys => {
                    Promise.all(keys.map(key => caches.delete(key)))
                        .then(() => {
                            showResult('‚úÖ Cache vid√© (' + keys.length + ' caches supprim√©s)');
                            setTimeout(() => location.reload(), 1000);
                        });
                });
            }
        }
        
        function unregisterSW() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(regs => {
                    Promise.all(regs.map(reg => reg.unregister()))
                        .then(() => {
                            showResult('‚úÖ Service Worker d√©sinstall√©');
                            setTimeout(() => location.reload(), 1000);
                        });
                });
            }
        }
        
        function fullReset() {
            if (confirm('‚ö†Ô∏è ATTENTION: Ceci va supprimer TOUTES tes donn√©es!\n\nExporte d\'abord un backup si tu veux garder tes s√©ances.\n\nContinuer?')) {
                localStorage.clear();
                clearCache();
                unregisterSW();
                showResult('‚úÖ Reset complet effectu√©');
                setTimeout(() => location.href = './index.html', 2000);
            }
        }
    </script>
</body>
</html>
